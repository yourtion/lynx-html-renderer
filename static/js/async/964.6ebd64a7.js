"use strict";(self.webpackChunklynx_html_renderer=self.webpackChunklynx_html_renderer||[]).push([["964"],{1791:function(n,e,r){r.r(e),r.d(e,{default:()=>t});var s=r(2676),i=r(453);function l(n){let e=Object.assign({h1:"h1",a:"a",h2:"h2",h3:"h3",p:"p",ol:"ol",li:"li",strong:"strong",ul:"ul",hr:"hr",pre:"pre",code:"code",h4:"h4",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,i.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"lynxhtmlrenderer-插件系统",children:["LynxHTMLRenderer 插件系统",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#lynxhtmlrenderer-插件系统",children:"#"})]}),"\n",(0,s.jsxs)(e.h2,{id:"1-设计目标design-goals",children:["1. 设计目标（Design Goals）",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#1-设计目标design-goals",children:"#"})]}),"\n",(0,s.jsxs)(e.h3,{id:"核心目标",children:["核心目标",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#核心目标",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"本插件系统用于 HTML AST → Capability-based LynxNode IR 的转换阶段，目标是："}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"高度模块化"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"HTML 语义处理被拆分为多个正交插件"}),"\n",(0,s.jsx)(e.li,{children:"单个插件职责单一、可独立替换"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"可被用户接管"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"内建插件无特殊地位"}),"\n",(0,s.jsx)(e.li,{children:"用户可以禁用、替换、重排任意插件"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"可演进"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["支持未来扩展：","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"table / list / media"}),"\n",(0,s.jsx)(e.li,{children:"自定义标签"}),"\n",(0,s.jsx)(e.li,{children:"业务组件映射"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"与 Renderer 解耦"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"插件只负责语义与能力建模"}),"\n",(0,s.jsx)(e.li,{children:"不关心最终如何渲染"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.h2,{id:"2-插件在整体架构中的位置",children:["2. 插件在整体架构中的位置",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#2-插件在整体架构中的位置",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"HTML String\n   ↓\nHTML Parser (htmlparser2)\n   ↓\nHTML AST\n   ↓\n┌──────────────────────────┐\n│   Transform Pipeline     │\n│                          │\n│  normalize Phase         │\n│  ├─ html-normalize       │\n│  └─ text-merge           │\n│                          │\n│  structure Phase         │\n│  ├─ block-structure      │\n│  ├─ list-structure       │\n│  └─ table-structure      │\n│                          │\n│  capability Phase        │\n│  ├─ style-capability     │\n│  ├─ layout-capability    │\n│  └─ media-capability     │\n│                          │\n│  finalize Phase          │\n│  (reserved)              │\n└──────────────────────────┘\n   ↓\nLynxNode Tree (IR)\n   ↓\nRenderer + Adapter Mapping\n   ↓\nLynx Native Components\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"插件系统只存在于 Transform 阶段"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.h2,{id:"3-核心类型定义",children:["3. 核心类型定义",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#3-核心类型定义",children:"#"})]}),"\n",(0,s.jsxs)(e.h3,{id:"31-transformphase",children:["3.1 TransformPhase",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#31-transformphase",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'export type TransformPhase =\n  | "normalize" // AST 预处理：实体解码、空白归一化\n  | "structure" // HTML 结构语义：标签转换、树构建\n  | "capability" // LynxNode 能力建模：样式、布局、媒体\n  | "finalize"; // 收尾处理：预留扩展\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"32-transformplugin",children:["3.2 TransformPlugin",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#32-transformplugin",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"export interface TransformPlugin {\n  /** 插件唯一标识（用于禁用 / 替换） */\n  name: string;\n  /** 所属执行阶段 */\n  phase: TransformPhase;\n  /** 同 phase 内执行顺序（数字越小越先执行） */\n  order?: number;\n  /** 是否默认启用 */\n  enabledByDefault?: boolean;\n\n  /** 可选：注册能力处理器（推荐用于 capability 阶段）\n   *\n   * 返回一个 Map，key 是节点类型（tag），value 是对应的处理器\n   * 引擎会在一次遍历中调用所有相关的处理器，提高性能\n   *\n   * 如果此方法存在，将优先于 apply() 使用\n   */\n  registerCapabilityHandlers?: (\n    ctx: TransformContext,\n  ) => Map<string, NodeCapabilityHandler>;\n\n  /** 插件执行入口（传统方式，向后兼容） */\n  apply(ctx: TransformContext): void;\n}\n\n/** 节点能力处理器类型 */\ntype NodeCapabilityHandler = (\n  node: LynxNode,\n  ctx: TransformContext,\n) => void | LynxNode;\n"})}),"\n",(0,s.jsxs)(e.h3,{id:"33-transformcontext",children:["3.3 TransformContext",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#33-transformcontext",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"export interface TransformContext {\n  /** 只读：HTML AST 根节点 */\n  readonly ast: HtmlAstNode;\n  /** 可写：LynxNode 根节点 */\n  root: LynxNode;\n  /** 工具方法 */\n  utils: {\n    /** 遍历 AST 所有节点 */\n    walkAst(cb: (node: HtmlAstNode) => void): void;\n    /** 创建新的 LynxNode */\n    createNode(partial: Partial<LynxNode>): LynxNode;\n    /** 替换已有 LynxNode */\n    replaceNode(target: LynxNode, next: LynxNode): void;\n    /** 注册能力处理器（用于批量处理优化） */\n    registerHandler(nodeKind: string, handler: NodeCapabilityHandler): void;\n  };\n  /** 元数据：插件间传递非结构化信息 */\n  metadata: Record<string, unknown>;\n  /** 内部：处理器注册表（用于批量处理） */\n  _handlerRegistry?: Map<string, NodeCapabilityHandler[]>;\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"metadata 常用键："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"removeAllClass"}),": 是否移除所有 class（默认 true）"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"removeAllStyle"}),": 是否移除所有 style（默认 false）"]}),"\n"]}),"\n",(0,s.jsxs)(e.h3,{id:"34-pluginconfig",children:["3.4 PluginConfig",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#34-pluginconfig",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"export interface PluginConfig {\n  /** 禁用指定的内建插件 */\n  disable?: string[];\n  /** 替换指定的内建插件 */\n  replace?: Record<string, TransformPlugin>;\n  /** 添加额外的自定义插件 */\n  extra?: TransformPlugin[];\n}\n"})}),"\n",(0,s.jsxs)(e.h2,{id:"4-插件执行流程",children:["4. 插件执行流程",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#4-插件执行流程",children:"#"})]}),"\n",(0,s.jsxs)(e.h3,{id:"41-执行顺序",children:["4.1 执行顺序",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#41-执行顺序",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["插件按 ",(0,s.jsx)(e.strong,{children:"phase → order"})," 顺序执行："]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const phaseOrder: Record<TransformPhase, number> = {\n  normalize: 1,\n  structure: 2,\n  capability: 3,\n  finalize: 4,\n};\n\n// 先按 phase 分组，同 phase 内按 order 排序\nplugins.sort((a, b) => {\n  const phaseDiff = phaseOrder[a.phase] - phaseOrder[b.phase];\n  if (phaseDiff !== 0) return phaseDiff;\n  return (a.order ?? 0) - (b.order ?? 0);\n});\n"})}),"\n",(0,s.jsxs)(e.h3,{id:"42-执行模型",children:["4.2 执行模型",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#42-执行模型",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'for (const phase of ["normalize", "structure", "capability", "finalize"]) {\n  const plugins = resolver.getPluginsByPhase(phase);\n  for (const plugin of plugins) {\n    plugin.apply(ctx);\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"特点："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"无条件顺序执行"}),"\n",(0,s.jsx)(e.li,{children:"无插件间直接调用"}),"\n",(0,s.jsx)(e.li,{children:"插件失败 = transform 失败"}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"5-内建插件详解",children:["5. 内建插件详解",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#5-内建插件详解",children:"#"})]}),"\n",(0,s.jsxs)(e.h3,{id:"51-normalize-phase预处理阶段",children:["5.1 Normalize Phase（预处理阶段）",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#51-normalize-phase预处理阶段",children:"#"})]}),"\n",(0,s.jsxs)(e.h4,{id:"511-html-normalize-插件",children:["5.1.1 html-normalize 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#511-html-normalize-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," 实体解码、空白节点标记"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/normalize/html-normalize.plugin.ts"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"作用："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["遍历 AST，标记纯空白文本节点（通过 ",(0,s.jsx)(e.code,{children:"isWhitespace"})," 标记）"]}),"\n",(0,s.jsxs)(e.li,{children:["后续 ",(0,s.jsx)(e.code,{children:"block-structure"})," 会过滤这些节点，避免产生无意义的 ",(0,s.jsx)(e.code,{children:"<text> </text>"})," 节点"]}),"\n"]}),"\n",(0,s.jsxs)(e.h4,{id:"512-text-merge-插件",children:["5.1.2 text-merge 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#512-text-merge-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," 合并相邻文本节点"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/normalize/text-merge.plugin.ts"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"作用："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"合并相邻的文本节点，减少节点数量"}),"\n",(0,s.jsx)(e.li,{children:"提升 Lynx 渲染性能"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.h3,{id:"52-structure-phase结构转换阶段",children:["5.2 Structure Phase（结构转换阶段）",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#52-structure-phase结构转换阶段",children:"#"})]}),"\n",(0,s.jsxs)(e.h4,{id:"521-block-structure-插件",children:["5.2.1 block-structure 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#521-block-structure-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," 将 HTML 块级元素转换为 LynxNode"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/structure/block-structure.plugin.ts"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"支持的标签："})," ",(0,s.jsx)(e.code,{children:"div"}),", ",(0,s.jsx)(e.code,{children:"p"}),", ",(0,s.jsx)(e.code,{children:"span"}),", ",(0,s.jsx)(e.code,{children:"h1"}),"-",(0,s.jsx)(e.code,{children:"h6"}),", ",(0,s.jsx)(e.code,{children:"blockquote"}),", ",(0,s.jsx)(e.code,{children:"pre"}),", ",(0,s.jsx)(e.code,{children:"br"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"核心逻辑："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"将 HTML AST 节点转换为 LynxNode 树"}),"\n",(0,s.jsxs)(e.li,{children:["根据 ",(0,s.jsx)(e.code,{children:"BLOCK_TAG_MAP"})," 映射标签到 Lynx 组件"]}),"\n",(0,s.jsxs)(e.li,{children:["保存原始 HTML 信息到 ",(0,s.jsx)(e.code,{children:"meta.sourceTag"})," 和 ",(0,s.jsx)(e.code,{children:"meta.sourceAttrs"})]}),"\n",(0,s.jsxs)(e.li,{children:["应用 ",(0,s.jsx)(e.code,{children:"defaultStyle"})," 和 ",(0,s.jsx)(e.code,{children:"capabilities"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"特殊处理："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"内联格式化标签"}),"（strong、em、u、code）：不创建包装元素，只传递 ",(0,s.jsx)(e.code,{children:"marks"}),"（bold、italic、underline、code）"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"br 标签"}),"：转换为 ",(0,s.jsx)(e.code,{children:"\\n"})," 文本节点"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"空白节点过滤"}),"：过滤被 ",(0,s.jsx)(e.code,{children:"html-normalize"})," 标记的节点"]}),"\n"]}),"\n",(0,s.jsxs)(e.h4,{id:"522-list-structure-插件",children:["5.2.2 list-structure 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#522-list-structure-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," 列表结构转换，添加列表标记"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/structure/list-structure.plugin.ts"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"支持的标签："})," ",(0,s.jsx)(e.code,{children:"ul"}),", ",(0,s.jsx)(e.code,{children:"ol"}),", ",(0,s.jsx)(e.code,{children:"li"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"作用："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["为 ",(0,s.jsx)(e.code,{children:"ol"})," 的每个 ",(0,s.jsx)(e.code,{children:"li"})," 添加数字标记（1. 2. 3.）"]}),"\n",(0,s.jsxs)(e.li,{children:["为 ",(0,s.jsx)(e.code,{children:"ul"})," 的每个 ",(0,s.jsx)(e.code,{children:"li"})," 添加项目符号（•）"]}),"\n",(0,s.jsx)(e.li,{children:"标记合并到第一个文本子节点，或作为独立文本节点插入"}),"\n"]}),"\n",(0,s.jsxs)(e.h4,{id:"523-table-structure-插件",children:["5.2.3 table-structure 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#523-table-structure-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," 表格结构转换，扁平化 thead/tbody/tfoot"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/structure/table-structure.plugin.ts"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"支持的标签："})," ",(0,s.jsx)(e.code,{children:"table"}),", ",(0,s.jsx)(e.code,{children:"thead"}),", ",(0,s.jsx)(e.code,{children:"tbody"}),", ",(0,s.jsx)(e.code,{children:"tfoot"}),", ",(0,s.jsx)(e.code,{children:"tr"}),", ",(0,s.jsx)(e.code,{children:"th"}),", ",(0,s.jsx)(e.code,{children:"td"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"作用："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["将 ",(0,s.jsx)(e.code,{children:"table"})," 结构转换为 Lynx ",(0,s.jsx)(e.code,{children:"view"})," 元素"]}),"\n",(0,s.jsxs)(e.li,{children:["扁平化 ",(0,s.jsx)(e.code,{children:"thead"}),"/",(0,s.jsx)(e.code,{children:"tbody"}),"/",(0,s.jsx)(e.code,{children:"tfoot"}),"，减少不必要的嵌套层级"]}),"\n",(0,s.jsx)(e.li,{children:"单个子节点的 section 直接展开，多个子节点保留包装"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.h3,{id:"53-capability-phase能力建模阶段",children:["5.3 Capability Phase（能力建模阶段）",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#53-capability-phase能力建模阶段",children:"#"})]}),"\n",(0,s.jsxs)(e.h4,{id:"531-style-capability-插件",children:["5.3.1 style-capability 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#531-style-capability-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," CSS 样式解析与转换"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/capability/style-capability.plugin.ts"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"作用："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["解析 ",(0,s.jsx)(e.code,{children:"style"})," 属性（",(0,s.jsx)(e.code,{children:"font-size: 14px; color: red;"}),"）"]}),"\n",(0,s.jsxs)(e.li,{children:["转换 kebab-case 为 camelCase（",(0,s.jsx)(e.code,{children:"font-size"})," → ",(0,s.jsx)(e.code,{children:"fontSize"}),"）"]}),"\n",(0,s.jsxs)(e.li,{children:["支持 ",(0,s.jsx)(e.code,{children:"removeAllStyle"})," 选项（移除所有 style）"]}),"\n",(0,s.jsxs)(e.li,{children:["从 ",(0,s.jsx)(e.code,{children:"meta.sourceAttrs.style"})," 提取样式并应用到 ",(0,s.jsx)(e.code,{children:"props.style"})]}),"\n"]}),"\n",(0,s.jsxs)(e.h4,{id:"532-layout-capability-插件",children:["5.3.2 layout-capability 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#532-layout-capability-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," 布局能力建模（block/inline）"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/capability/layout-capability.plugin.ts"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"作用："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"为元素添加布局能力标记（block/inline）"}),"\n",(0,s.jsxs)(e.li,{children:["从 ",(0,s.jsx)(e.code,{children:"BLOCK_TAG_MAP"})," 读取 ",(0,s.jsx)(e.code,{children:"capabilities"})," 并设置到元素"]}),"\n",(0,s.jsx)(e.li,{children:"指导后续渲染器选择合适的布局组件"}),"\n"]}),"\n",(0,s.jsxs)(e.h4,{id:"533-media-capability-插件",children:["5.3.3 media-capability 插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#533-media-capability-插件",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"职责："})," 媒体元素处理（img）"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"文件："})," ",(0,s.jsx)(e.code,{children:"src/transform/plugins/capability/media-capability.plugin.ts"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"作用："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["提取 ",(0,s.jsx)(e.code,{children:"img"})," 的 ",(0,s.jsx)(e.code,{children:"src"})," 属性到 ",(0,s.jsx)(e.code,{children:"props.src"})]}),"\n",(0,s.jsxs)(e.li,{children:["保持图片尺寸（",(0,s.jsxs)(e.strong,{children:["即使 ",(0,s.jsx)(e.code,{children:"removeAllStyle=true"})]}),"）"]}),"\n",(0,s.jsxs)(e.li,{children:["三级优先级策略：","\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["HTML 属性：",(0,s.jsx)(e.code,{children:'width="200" height="100"'})]}),"\n",(0,s.jsxs)(e.li,{children:["style 属性提取：",(0,s.jsx)(e.code,{children:'style="width:150px;height:100px"'})]}),"\n",(0,s.jsxs)(e.li,{children:["默认值：",(0,s.jsx)(e.code,{children:"width: 100%; height: auto"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"order 设为 100，确保在 style-capability 之后执行"}),"\n"]}),"\n",(0,s.jsxs)(e.h4,{id:"534-capability-handler-pattern性能优化",children:["5.3.4 Capability Handler Pattern（性能优化）",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#534-capability-handler-pattern性能优化",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"动机："})," Capability 阶段的多个插件都遍历完整的 LynxNode 树，造成重复遍历。使用 Handler Pattern 可以将 3 次遍历优化为 1 次。"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"原理："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"插件注册针对特定节点类型的处理器（handlers）"}),"\n",(0,s.jsx)(e.li,{children:"Transform 引擎在一次遍历中调用所有处理器"}),"\n",(0,s.jsx)(e.li,{children:"保持插件独立性和可替换性"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"示例："})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"import type { TransformPlugin } from \"lynx-html-renderer/transform\";\n\nconst myCapabilityPlugin: TransformPlugin = {\n  name: \"my-capability\",\n  phase: \"capability\",\n  order: 50,\n\n  // 注册处理器（推荐用于 capability 阶段）\n  registerCapabilityHandlers(ctx) {\n    const handlers = new Map<string, NodeCapabilityHandler>();\n\n    // 为 \"view\" 节点注册处理器\n    handlers.set('view', (node) => {\n      // ❌ BAD: 直接处理，没有提前检查\n      // node.props = { ...node.props, customAttr: processComplex(node) };\n\n      // ✅ GOOD: 提前检查 + 快速返回\n      if (!node.meta?.sourceAttrs?.['data-custom']) return;  // 快速跳过不相关节点\n      if (ctx.metadata.skipCustomAttrs) return;                // 全局配置检查\n\n      // 只有通过所有检查才执行实际处理\n      node.props = {\n        ...node.props,\n        customAttr: node.meta.sourceAttrs['data-custom'],\n      };\n    });\n\n    // 一个插件可以处理多种节点类型\n    handlers.set('text', (node) => {\n      if (!node.meta?.sourceAttrs?.['data-text-custom']) return;\n      // 处理 text 节点的特殊逻辑\n    });\n\n    handlers.set('image', (node) => {\n      if (!node.meta?.sourceAttrs?.['data-image-custom']) return;\n      // 处理 image 节点的特殊逻辑\n    });\n\n    return handlers;\n  },\n\n  // 传统 apply() 方法（向后兼容）\n  apply(ctx) {\n    // 如果 registerCapabilityHandlers 存在，此方法将被忽略\n    ctx.utils.walkAst((node) => {\n      // ... 传统实现 ...\n    });\n  },\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"性能提升："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Capability 阶段从 3 次遍历 → 1 次遍历"}),"\n",(0,s.jsx)(e.li,{children:"对于 medium 文档（100-1000 节点），节省约 2 次完整树遍历"}),"\n",(0,s.jsx)(e.li,{children:"整体性能提升约 15-20%（在已完成优化的基础上）"}),"\n",(0,s.jsx)(e.li,{children:"Handler 内部提前 return 进一步减少不必要的计算"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"最佳实践："})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Handler 内部提前 Return"}),"（CRITICAL）:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"handlers.set('view', (node) => {\n  // 检查顺序：从快到慢\n  // 1. 全局配置检查（最快）\n  if (ctx.metadata.removeAllStyle) return;\n\n  // 2. 必要属性存在性检查\n  if (!node.meta?.sourceAttrs?.style) return;\n\n  // 3. 实际处理逻辑（最慢，只在必要时执行）\n  const style = parseStyleString(node.meta.sourceAttrs.style);\n  node.props = { ...node.props, style };\n});\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"一个插件处理多种节点类型"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"// ✅ 推荐：按节点类型注册不同的处理器\nhandlers.set('view', viewHandler);\nhandlers.set('text', textHandler);\nhandlers.set('image', imageHandler);\n\n// 每个 handler 可以有不同的实现细节\nconst viewHandler = (node) => { /* view 特定逻辑 */ };\nconst textHandler = (node) => { /* text 特定逻辑 */ };\nconst imageHandler = (node) => { /* image 特定逻辑 */ };\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"处理器设计原则"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"快速失败"}),": 用简单的条件检查快速跳过不相关的节点"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"幂等性"}),": 多次执行结果相同"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"无副作用"}),": 不修改节点以外的状态"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"单一职责"}),": 每个 handler 只做一件事"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"性能对比"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"传统方式（3次遍历）:\n- 遍历1: style-capability 处理所有节点（1000个节点访问）\n- 遍历2: layout-capability 处理所有节点（1000个节点访问）\n- 遍历3: media-capability 处理所有节点（1000个节点访问）\n总计: 3000次节点访问\n\nHandler Pattern（1次遍历 + 提前return）:\n- 遍历1: 引擎遍历所有节点（1000个节点访问）\n       - 每个节点触发对应的 handlers（快速检查后跳过大部分）\n总计: ~1000次节点访问 + 少量handler调用\n\n性能提升: ~3倍（减少重复遍历）+ 额外收益（提前return）\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"6-用户-api-使用示例",children:["6. 用户 API 使用示例",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#6-用户-api-使用示例",children:"#"})]}),"\n",(0,s.jsxs)(e.h3,{id:"61-基础使用",children:["6.1 基础使用",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#61-基础使用",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'import { transformHTML } from "lynx-html-renderer/html-parser";\n\nconst html = "<div>Hello World</div>";\nconst nodes = transformHTML(html);\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"62-禁用内建插件",children:["6.2 禁用内建插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#62-禁用内建插件",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'const nodes = transformHTML(html, {\n  plugins: {\n    disable: ["table-structure"],\n  },\n});\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"63-替换内建插件",children:["6.3 替换内建插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#63-替换内建插件",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'const customPlugin: TransformPlugin = {\n  name: "block-structure",\n  phase: "structure",\n  order: 10,\n  apply(ctx) {\n    // 自定义逻辑\n  },\n};\n\nconst nodes = transformHTML(html, {\n  plugins: {\n    replace: {\n      "block-structure": customPlugin,\n    },\n  },\n});\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"64-添加自定义插件",children:["6.4 添加自定义插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#64-添加自定义插件",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'const analyticsPlugin: TransformPlugin = {\n  name: "analytics",\n  phase: "capability",\n  order: 1000,\n  apply(ctx) {\n    ctx.utils.walkAst((node) => {\n      ctx.metadata.nodeCount = ((ctx.metadata.nodeCount as number) ?? 0) + 1;\n    });\n  },\n};\n\nconst nodes = transformHTML(html, {\n  plugins: {\n    extra: [analyticsPlugin],\n  },\n});\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"65-完整配置示例",children:["6.5 完整配置示例",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#65-完整配置示例",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'const nodes = transformHTML(html, {\n  removeAllClass: true,\n  removeAllStyle: false,\n  plugins: {\n    disable: ["text-merge"],\n    replace: {\n      "media-capability": myCustomMediaPlugin,\n    },\n    extra: [analyticsPlugin, customTagPlugin],\n  },\n});\n'})}),"\n",(0,s.jsxs)(e.h2,{id:"7-插件开发指南",children:["7. 插件开发指南",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#7-插件开发指南",children:"#"})]}),"\n",(0,s.jsxs)(e.h3,{id:"71-创建自定义插件",children:["7.1 创建自定义插件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#71-创建自定义插件",children:"#"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:'import type { TransformPlugin } from "lynx-html-renderer/transform";\n\nconst myPlugin: TransformPlugin = {\n  name: "my-custom-plugin",\n  phase: "capability",\n  order: 50,\n  enabledByDefault: true,\n  apply(ctx) {\n    // 访问 AST\n    ctx.utils.walkAst((node) => {\n      // 处理 AST 节点\n    });\n\n    // 访问 LynxNode Tree\n    const root = ctx.root;\n\n    // 创建/替换节点\n    const newNode = ctx.utils.createNode({ kind: "text", content: "Hello" });\n    ctx.utils.replaceNode(oldNode, newNode);\n\n    // 使用 metadata 与其他插件通信\n    ctx.metadata.myData = "value";\n  },\n};\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"72-插件最佳实践",children:["7.2 插件最佳实践",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#72-插件最佳实践",children:"#"})]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"职责单一"}),"：每个插件只做一件事"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"幂等性"}),"：多次执行结果相同"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"无副作用"}),"：不修改全局状态"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"错误处理"}),"：捕获异常，避免影响其他插件"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"性能考虑"}),"：避免深层递归，使用 ",(0,s.jsx)(e.code,{children:"walkAst"})," 优化遍历"]}),"\n"]}),"\n",(0,s.jsxs)(e.h3,{id:"73-选择正确的-phase",children:["7.3 选择正确的 Phase",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#73-选择正确的-phase",children:"#"})]}),"\n",(0,s.jsxs)(e.table,{children:["\n",(0,s.jsxs)(e.thead,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.th,{children:"Phase"}),"\n",(0,s.jsx)(e.th,{children:"适用场景"}),"\n",(0,s.jsx)(e.th,{children:"示例"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.tbody,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"normalize"})}),"\n",(0,s.jsx)(e.td,{children:"AST 预处理"}),"\n",(0,s.jsx)(e.td,{children:"实体解码、空白标记"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"structure"})}),"\n",(0,s.jsx)(e.td,{children:"结构转换"}),"\n",(0,s.jsx)(e.td,{children:"标签映射、树构建"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"capability"})}),"\n",(0,s.jsx)(e.td,{children:"能力建模"}),"\n",(0,s.jsx)(e.td,{children:"样式解析、布局计算"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"finalize"})}),"\n",(0,s.jsx)(e.td,{children:"收尾处理"}),"\n",(0,s.jsx)(e.td,{children:"节点清理、统计信息"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"8-与-renderer-的职责边界",children:["8. 与 Renderer 的职责边界",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#8-与-renderer-的职责边界",children:"#"})]}),"\n",(0,s.jsxs)(e.table,{children:["\n",(0,s.jsxs)(e.thead,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.th,{children:"Transform Plugin"}),"\n",(0,s.jsx)(e.th,{children:"Renderer"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.tbody,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"语义归一化"}),"\n",(0,s.jsx)(e.td,{children:"组件选择"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"能力建模"}),"\n",(0,s.jsx)(e.td,{children:"布局实现"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"表格结构"}),"\n",(0,s.jsx)(e.td,{children:"表格绘制"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"样式解析"}),"\n",(0,s.jsx)(e.td,{children:"样式应用"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:["插件不关心 ",(0,s.jsx)(e.code,{children:"createElement"}),"，只关心语义建模"]})}),"\n",(0,s.jsxs)(e.h2,{id:"9-总结",children:["9. 总结",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#9-总结",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"该插件系统："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"✅ 把 HTML 渲染问题拆解为可控的语义问题"}),"\n",(0,s.jsxs)(e.li,{children:["✅ 允许用户",(0,s.jsx)(e.strong,{children:"删除、替换、扩展"}),"任何内建逻辑"]}),"\n",(0,s.jsx)(e.li,{children:"✅ 为复杂场景（table / 自定义组件）预留演进空间"}),"\n",(0,s.jsx)(e.li,{children:"✅ 不牺牲 MVP 落地速度"}),"\n",(0,s.jsx)(e.li,{children:"✅ 保持向后兼容性"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"内建插件清单（8 个）："})}),"\n",(0,s.jsxs)(e.table,{children:["\n",(0,s.jsxs)(e.thead,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.th,{children:"Phase"}),"\n",(0,s.jsx)(e.th,{children:"Plugin"}),"\n",(0,s.jsx)(e.th,{children:"Order"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.tbody,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"normalize"}),"\n",(0,s.jsx)(e.td,{children:"html-normalize"}),"\n",(0,s.jsx)(e.td,{children:"10"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"normalize"}),"\n",(0,s.jsx)(e.td,{children:"text-merge"}),"\n",(0,s.jsx)(e.td,{children:"20"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"structure"}),"\n",(0,s.jsx)(e.td,{children:"block-structure"}),"\n",(0,s.jsx)(e.td,{children:"10"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"structure"}),"\n",(0,s.jsx)(e.td,{children:"list-structure"}),"\n",(0,s.jsx)(e.td,{children:"20"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"structure"}),"\n",(0,s.jsx)(e.td,{children:"table-structure"}),"\n",(0,s.jsx)(e.td,{children:"30"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"capability"}),"\n",(0,s.jsx)(e.td,{children:"style-capability"}),"\n",(0,s.jsx)(e.td,{children:"10"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"capability"}),"\n",(0,s.jsx)(e.td,{children:"layout-capability"}),"\n",(0,s.jsx)(e.td,{children:"20"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"capability"}),"\n",(0,s.jsx)(e.td,{children:"media-capability"}),"\n",(0,s.jsx)(e.td,{children:"100"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"10-相关文件",children:["10. 相关文件",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#10-相关文件",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"核心类型："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/transform/types.ts"})," - TransformPlugin、TransformContext"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/transform/context.ts"})," - TransformContextImpl"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/transform/resolver.ts"})," - TransformPluginResolver"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/transform/engine.ts"})," - transformHTML 主引擎"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"内建插件："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/transform/plugins/normalize/"})," - html-normalize、text-merge"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/transform/plugins/structure/"})," - block-structure、list-structure、table-structure"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/transform/plugins/capability/"})," - style-capability、layout-capability、media-capability"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"工具函数："})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/ast/walkers.ts"})," - AST 遍历工具"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"src/lynx/factory.ts"})," - LynxNode 工厂函数"]}),"\n"]})]})}function d(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,i.ah)(),n.components);return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}let t=d;d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["plugin.md"]={toc:[{text:"1. 设计目标（Design Goals）",id:"1-设计目标design-goals",depth:2},{text:"核心目标",id:"核心目标",depth:3},{text:"2. 插件在整体架构中的位置",id:"2-插件在整体架构中的位置",depth:2},{text:"3. 核心类型定义",id:"3-核心类型定义",depth:2},{text:"3.1 TransformPhase",id:"31-transformphase",depth:3},{text:"3.2 TransformPlugin",id:"32-transformplugin",depth:3},{text:"3.3 TransformContext",id:"33-transformcontext",depth:3},{text:"3.4 PluginConfig",id:"34-pluginconfig",depth:3},{text:"4. 插件执行流程",id:"4-插件执行流程",depth:2},{text:"4.1 执行顺序",id:"41-执行顺序",depth:3},{text:"4.2 执行模型",id:"42-执行模型",depth:3},{text:"5. 内建插件详解",id:"5-内建插件详解",depth:2},{text:"5.1 Normalize Phase（预处理阶段）",id:"51-normalize-phase预处理阶段",depth:3},{text:"5.1.1 html-normalize 插件",id:"511-html-normalize-插件",depth:4},{text:"5.1.2 text-merge 插件",id:"512-text-merge-插件",depth:4},{text:"5.2 Structure Phase（结构转换阶段）",id:"52-structure-phase结构转换阶段",depth:3},{text:"5.2.1 block-structure 插件",id:"521-block-structure-插件",depth:4},{text:"5.2.2 list-structure 插件",id:"522-list-structure-插件",depth:4},{text:"5.2.3 table-structure 插件",id:"523-table-structure-插件",depth:4},{text:"5.3 Capability Phase（能力建模阶段）",id:"53-capability-phase能力建模阶段",depth:3},{text:"5.3.1 style-capability 插件",id:"531-style-capability-插件",depth:4},{text:"5.3.2 layout-capability 插件",id:"532-layout-capability-插件",depth:4},{text:"5.3.3 media-capability 插件",id:"533-media-capability-插件",depth:4},{text:"5.3.4 Capability Handler Pattern（性能优化）",id:"534-capability-handler-pattern性能优化",depth:4},{text:"6. 用户 API 使用示例",id:"6-用户-api-使用示例",depth:2},{text:"6.1 基础使用",id:"61-基础使用",depth:3},{text:"6.2 禁用内建插件",id:"62-禁用内建插件",depth:3},{text:"6.3 替换内建插件",id:"63-替换内建插件",depth:3},{text:"6.4 添加自定义插件",id:"64-添加自定义插件",depth:3},{text:"6.5 完整配置示例",id:"65-完整配置示例",depth:3},{text:"7. 插件开发指南",id:"7-插件开发指南",depth:2},{text:"7.1 创建自定义插件",id:"71-创建自定义插件",depth:3},{text:"7.2 插件最佳实践",id:"72-插件最佳实践",depth:3},{text:"7.3 选择正确的 Phase",id:"73-选择正确的-phase",depth:3},{text:"8. 与 Renderer 的职责边界",id:"8-与-renderer-的职责边界",depth:2},{text:"9. 总结",id:"9-总结",depth:2},{text:"10. 相关文件",id:"10-相关文件",depth:2}],title:"LynxHTMLRenderer 插件系统",headingTitle:"LynxHTMLRenderer 插件系统",frontmatter:{}}}}]);